# SPDX-FileCopyrightText: Copyright 2020-2025, Contributors to Tyrannosaurus
# SPDX-PackageHomePage: https://github.com/dmyersturnbull/tyrannosaurus
# SPDX-License-Identifier: Apache-2.0

# Runs the release process when `validate` completes successfully (after a tag is pushed).

on:
  workflow_run:
    types:
      - completed
    workflows:
      - validate

permissions:
  contents: read

jobs:
  accept:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    steps:
      - run: |
          printf "Accepted %s for release.\n" "${{ github.ref_name }}"
  update-codecov:
    needs: accept
    uses: ./.github/workflows/_update-codecov.yaml
  update-coveralls:
    needs: accept
    uses: ./.github/workflows/_update-coveralls.yaml
  publish-docs:
    needs: accept
    permissions:
      pages: write
    uses: .github/workflows/_publish-docs.yaml
  publish-github:
    needs: accept
    permissions:
      pages: write
    uses: .github/workflows/_publish-github.yaml
  publish-pypi:
    needs: accept
    uses: .github/workflows/_publish-pypi.yaml
  publish-docker:
    needs: accept
    uses: .github/workflows/_publish-docker.yaml
